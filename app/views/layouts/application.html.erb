<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Habit App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <%= stylesheet_link_tag :application, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <div class="d-flex align-items-center">
      <div class="header__left">
        <%= link_to 'HabitApp', root_path, class: "header__brand" %>
      </div>
      <div class="header_right ms-auto">
        <ul class="navbar-nav flex-row align-items-center justify-content-end">
          <% if user_signed_in? %>
            <li class="nav-item"><%= link_to "Home", home_path_with_goal, class:"btn btn-link" %></li>
            <li class="nav-item">
              <% if user_signed_in? && (goal = current_user.goals.order(created_at: :desc).first) %>
                <%= link_to "Goal詳細", goal_path(goal), class: "nav-link" %>
              <% else %>
                <%= link_to "Goal一覧", goals_path, class: "nav-link" %>
              <% end %></li>
            <li class="nav-item"><%= link_to "Profile", profile_path(current_user), class: "nav-link" %></li>
            <li class="nav-item dropdown ms-2">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                <i class="bi bi-bell me-3"></i>
                <div class="rounded-circle bg-dark text-white d-inline-grid me-2" style="width:28px;height:28px;place-items:center;font-size:.75rem;">
                  <%= (current_user.name || current_user.email)[0].upcase %>
                </div>
                <span><%= current_user.name.presence || current_user.email %></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><%= link_to raw('<i class="bi bi-person me-2"></i>プロフィール'), class: "dropdown-item" %></li>
                <li><%= link_to raw('<i class="bi bi-heart me-2"></i>フォロー/いいね'), "#", class: "dropdown-item" %></li>
                <li><hr class="dropdown-divider"></li>
                <li><%= link_to raw('<i class="bi bi-box-arrow-right me-2"></i>ログアウト'),
                      destroy_user_session_path, data: { turbo_method: :delete }, class: "dropdown-item text-danger" %></li>
              </ul>
            </li>
          <% else %>
            <li class="nav-item"><%= link_to "ログイン", new_user_session_path, class: "nav-link" %></li>
            <li class="nav-item"><%= link_to "新規登録", new_user_registration_path, class: "nav-link" %></li>
          <% end %>
        </ul>
      </div>
    </div>
    <%= yield %>
  </body>
</html>
